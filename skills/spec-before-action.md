# 仕様先行の原則（Spec-Before-Action）

## 絶対ルール

**仕様が完全に確定するまで、実装指示を家老・奉行・足軽に送るな。**

これは全エージェント共通の鉄則である。違反は殿の逆鱗に触れる。

## なぜこのルールが必要か

- 不完全な仕様を送ると、家老は即座に実装を開始する
- 途中で仕様変更が入ると、作業が無駄になる
- 「とりあえず送って後から修正」は禁止。最初から完全な仕様を作れ

## 仕様確定の条件

以下が**すべて**揃うまで、下流（家老・奉行・足軽）に一切送るな:

1. **既存コードの調査が完了している** — 現状の挙動・条件・トリガーを把握済み
2. **仕様の全項目に根拠がある** — ハードコード値には設定ファイルや既存仕様からの根拠が必要
3. **仕様同士のつながりが整合している** — ある項目の決定が他の項目に影響する場合、全体で矛盾がないこと
4. **殿の明示的な承認を得ている** — 「これで送れ」等の明確な許可

## 仕様策定の手順

```
Step 1: 既存コードを調査（現状の挙動・条件を把握）
Step 2: 課題を整理（何が問題で、何を変えるべきか）
Step 3: 仕様案を殿に提示（選択肢がある場合は全て提示）
Step 4: 殿の判断を待つ（勝手に選択しない）
Step 5: 仕様の全項目が確定したか確認
Step 6: 殿に最終承認を求める（「この仕様で送ってよいか」）
Step 7: 承認後、初めて下流に送信
```

## 禁止事項

| 禁止行為 | 理由 |
|----------|------|
| 不完全な仕様を先行送信 | 家老が即実装を開始し、手戻りが発生する |
| 仕様の一部だけ決めて送信 | 残りの仕様が他の項目に影響する可能性がある |
| 殿の回答を待たずに仮定で進める | 殿の意図と異なる方向に進む |
| 調査なしで仕様を書く | 既存の挙動を知らずに仕様を書くと的外れになる |
| 根拠なき数値のハードコード | 設定ファイルや既存仕様から導出すること |

## 仕様のつながり確認チェックリスト

仕様を送る前に以下を確認:

- [ ] 全項目が具体的か（「適切に処理する」等の曖昧表現がないか）
- [ ] 項目間の依存関係は整合しているか（Aの条件がBの挙動に矛盾しないか）
- [ ] 既存の設定値・間隔・閾値と整合しているか
- [ ] 禁止事項が明確か（何をしてはいけないかが書かれているか）
- [ ] 殿の承認を得たか

## 適用範囲

- 将軍 → 家老への命令送信時
- 家老 → 奉行への委任時
- 奉行 → 足軽への作業指示時
- **全階層で適用。「急いでいるから」は免罪符にならない。**
