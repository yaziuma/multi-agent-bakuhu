{% extends "base.html" %}

{%- block title -%}Queue Viewer - Directory Tree{%- endblock -%}

{%- macro render_tree(items) -%}
<ul class="tree-items">
{%- for item in items -%}
  {%- if item.is_dir -%}
    <li class="tree-folder">
      {%- if item.children -%}
        <details class="tree-folder-details">
          <summary class="tree-folder-summary">
            <span class="tree-icon">ğŸ“</span>
            <span class="tree-name">{{ item.name }}/</span>
          </summary>
          {{ render_tree(item.children) }}
        </details>
      {%- else -%}
        <span class="tree-icon">ğŸ“</span>
        <span class="tree-name">{{ item.name }}/</span>
      {%- endif -%}
    </li>
  {%- else -%}
    <li class="tree-file">
      <span class="tree-icon">ğŸ“„</span>
      <a href="{{ base_path }}/file/{{ item.path }}" class="tree-link">{{ item.name }}</a>
    </li>
  {%- endif -%}
{%- endfor -%}
</ul>
{%- endmacro -%}

{%- block content -%}
<div class="container">
    <aside class="sidebar">
        <details class="quick-access-details">
            <summary class="quick-access-summary">ğŸ“‚ Quick Access</summary>
            <ul class="quick-links">
            <li>
                <a href="{{ base_path }}/file/dashboard.md">ğŸ“Š dashboard.md</a>
            </li>
            <li>
                <a href="{{ base_path }}/file/queue/shogun_to_karo.yaml">ğŸ“œ Command Queue</a>
            </li>
            <li>
                <strong>ğŸ“ Tasks:</strong>
                <ul>
                    <li><a href="{{ base_path }}/file/queue/tasks/ashigaru1.yaml">è¶³è»½1å·</a></li>
                    <li><a href="{{ base_path }}/file/queue/tasks/ashigaru2.yaml">è¶³è»½2å·</a></li>
                </ul>
            </li>
            <li>
                <strong>ğŸ“¬ Inbox:</strong>
                <ul>
                    <li><a href="{{ base_path }}/file/queue/inbox/shogun.yaml">å°†è»</a></li>
                    <li><a href="{{ base_path }}/file/queue/inbox/karo.yaml">å®¶è€</a></li>
                    <li><a href="{{ base_path }}/file/queue/inbox/ashigaru1.yaml">è¶³è»½1å·</a></li>
                    <li><a href="{{ base_path }}/file/queue/inbox/ashigaru2.yaml">è¶³è»½2å·</a></li>
                </ul>
            </li>
            <li>
                <strong>ğŸ“‹ Reports:</strong>
                <ul>
                    <li><a href="{{ base_path }}/file/queue/reports/ashigaru1_report.yaml">è¶³è»½1å·</a></li>
                    <li><a href="{{ base_path }}/file/queue/reports/ashigaru2_report.yaml">è¶³è»½2å·</a></li>
                </ul>
            </li>
        </ul>
        </details>
    </aside>

    <section class="main-content">
        <h2>ğŸ—‚ï¸ Directory Tree</h2>

        <div class="search-box">
            <input type="text" name="q" id="search-input" placeholder="ğŸ” ãƒ•ã‚¡ã‚¤ãƒ«åã§æ¤œç´¢..."
                   hx-get="{{ base_path }}/search"
                   hx-trigger="input changed delay:300ms"
                   hx-target="#tree-container"
                   hx-swap="innerHTML"
                   autocomplete="off">
        </div>

        <div class="tree-view" id="tree-container">
            {{- render_tree(tree) -}}
        </div>
    </section>
</div>
{%- endblock -%}
