# pyprologをmulti-agent-bakuhu運用に活かす視点（逆方向）

## 目的
- **multi-agent-bakuhuの運用ルールを機械的に判断・検証・自動化**するために、
  pyprolog（Prolog推論エンジン）を補助ツールとして使う。
- LLMの「判断コスト」や「読み取りコスト」を、
  **ルールベース推論**で置き換える／軽減する。

---

## 1) ルール判定エンジンとしての活用

### 使い方の基本形
- `queue/*.yaml` や `config/settings.yaml` を **事実（facts）** に変換
- Prologルールで「割当可否」「禁止違反」「優先度」などを判定
- LLMは **結果だけ** を読む

### 例: ルール判定
- 「足軽は自分専用ファイルだけ読む」
- 「/clearは完了報告後のみ送る」
- 「外部エージェント召喚は伝令経由のみ」

→ **違反検知**をpyprologで機械判定可能

---

## 2) タスク割当の自動検証

### 目的
- 家老のタスク分解がルールに沿っているかを機械チェック

### 実現方法
- `queue/tasks/ashigaru{N}.yaml` を facts 化
- ルール例:
  - `model_override` が不要に指定されていないか
  - 同一ファイルへの割当が複数足軽に出ていないか（RACE-001）
  - `priority` が欠落していないか

### 効果
- 家老レビューの負担を軽減
- LLMの読み込み前に機械的に弾ける

---

## 3) 進捗/履歴の整理判断

### 目的
- 「どの報告が未反映か」「退避すべき履歴か」をPrologで判断

### 実現方法
- `dashboard.md` の履歴部分を簡易fact化
- `queue/reports/*.yaml` と突合

### 例ルール
- 「done かつ dashboard に反映済みなら退避候補」
- 「reportのtask_idがdashboardに存在しないなら未反映」

---

## 4) 読み取り範囲の最小化支援

### 目的
- LLMが読むべき範囲をpyprologが指定

### 実現方法
- YAML/Markdownをセクションfactとして登録
- 「必要セクションだけを出力」するPrologクエリ

### 効果
- LLMは「抽出結果のみ」を読む
- トークン消費が安定

---

## 5) 外部エージェント召喚の判断補助

### 目的
- 忍び/軍師を呼ぶべき条件を機械判断

### 例
- 「最新情報を含む → 忍び」
- 「設計判断/トレードオフ → 軍師」
- 「実装 → 足軽」

Prologで **分類ルール** を持ち、家老が参照可能。

---

## 6) 具体的な導入ステップ（最小）

1. **YAML→facts変換スクリプト**を用意
   - 例: `queue/tasks/ashigaru1.yaml` → `task(ashigaru1, task_id, priority, status, target_path).`

2. **基本ルールセット**を作成
   - 禁止事項チェック
   - RACE-001検知
   - 未反映レポート検知

3. **pyprologクエリで結果出力**
   - LLMは結果だけ読む

---

## 結論
pyprologは「推論・判定・検証」を得意とするため、
**multi-agent-bakuhuの運用ルールを機械的に処理する補助エンジン**として最適。
特に以下の領域で効果が大きい:
- ルール違反の検知
- タスク割当の妥当性チェック
- 履歴・報告の未反映判定
- LLMの読み取り範囲最小化

この方向なら、LLMは「結果だけ読む」運用にでき、
コスト削減と運用品質向上を両立できる。

