# AI News Anchor 設計ドキュメント

## 1. 技術選定

- **TTS: Kokoro TTS**
  - Apache 2.0ライセンスで**商用利用可能・クレジット表記不要**
  - オフライン動作可能（外部サービス依存なし）
  - 日本語対応（品質4/5）
  - VOICEVOXはクレジット表記必須のため不採用

- **Video: MoviePy**
  - 研究レポートでは「静止画＋音声から動画を作る用途に最もシンプル」「高レベルAPIで扱いやすい」と整理されており、MVPの開発速度を優先できる。
  - FFmpeg依存がある点も明記されているため、DockerにFFmpegを同梱する設計が必須。

- **RSS: feedparser**
  - 研究レポートの主眼はTTS/動画だが、「シンプルで確実なパイプラインを最短で作る」方針に沿うため、Pythonでデファクトに使われるfeedparserを採用する。
  - 「ニュース取得→要約→原稿→TTS→動画」の流れで最初の入口となるため、軽量・安定で保守コストが低い選択を優先する。

## 2. アーキテクチャ設計

**システム全体図（ASCII）**

```
┌─────────────────────────────────────────────┐
│                 Orchestrator               │
│  (main pipeline / scheduler entrypoint)    │
└─────────────────────────────────────────────┘
           │
           ▼
┌─────────────────┐    ┌───────────────────┐
│   RSS Fetcher   │───▶│  AI Scriptgen     │
│ (feedparser)    │    │ (LLM summarize)   │
└─────────────────┘    └───────────────────┘
           │                      │
           ▼                      ▼
┌─────────────────┐    ┌───────────────────┐
│   Data Store    │    │   TTS Client      │
│ (cache/metadata)│    │ (Kokoro TTS)      │
└─────────────────┘    └───────────────────┘
                                  │
                                  ▼
                         ┌───────────────────┐
                         │  Video Generator  │
                         │   (MoviePy+FFmpeg)│
                         └───────────────────┘
                                  │
                                  ▼
                         ┌───────────────────┐
                         │  YouTube Uploader │
                         └───────────────────┘
```

**モジュール分割と責務**

- `news/` RSS取得・正規化
  - feedparserで記事一覧を取得
  - 記事の本文取得（必要なら簡易スクレイピング）
  - 既読管理（URLのハッシュ保存）

- `ai/` 要約・原稿生成
  - ニュース本文の要約
  - ニュース読み上げ用の台本生成（尺・語尾・口調の制御）

- `tts/` 音声合成
  - Kokoro TTSによる音声生成
  - 話者・速度パラメータ設定
  - 生成音声の保存とメタ情報記録

- `video/` 動画生成
  - テンプレート画像＋音声から動画生成
  - BGM/効果音（Phase 2以降）
  - サムネイル用画像生成（Phase 2以降）

- `youtube/` アップロード
  - YouTube APIによる動画アップロード
  - タイトル/概要欄/タグ生成

- `orchestrator/` 全体制御
  - 失敗時のリトライとログ
  - 処理ステップ間の中間成果物管理

**データフロー（RSS → YouTube）**

1. RSS取得（feedparser）
2. 記事本文抽出
3. LLMで要約・台本生成
4. Kokoro TTSで音声生成
5. MoviePyで音声＋画像から動画化
6. YouTube APIでアップロード
7. 成果物とメタデータを保存（履歴・再実行用）

## 3. 実装フェーズ

**Phase 1 (MVP): Core pipeline working**

- RSS → 要約 → 台本 → TTS → 動画 → アップロードの最短動線
- シンプルな固定テンプレ画像とBGMなし
- Kokoro TTSをローカルで起動（オフライン動作）
- 1ニュース1本の生成に限定

**Phase 2: 品質改善**

- 複数ニュースを束ねた番組形式
- イントネーション調整、話者選択、音量正規化
- BGMやジングル導入
- サムネイル自動生成（タイトル/日付/トピック入り）
- 失敗時リトライ・部分再実行

**Phase 3: 本番運用対応**

- Docker化 + cronで定期実行
- ログ/監視/通知（成功・失敗のWebhook）
- 生成コスト最適化（キャッシュ・再利用）
- 設定ファイル・環境変数の分離

## 4. デプロイ戦略

**開発環境: ローカル実行**

- `uv run` でパイプラインを実行
- Kokoro TTSはPythonライブラリとして直接呼び出し（外部プロセス不要）

**本番環境: Docker + cron（推奨）**

- Dockerによる依存分離（FFmpeg、Kokoro TTS等）
- cronで定期実行し、YouTubeへ自動投稿

**Kokoro TTS統合**

- Pythonライブラリとしてアプリに組み込み（別コンテナ不要）
- Apache 2.0ライセンス、クレジット表記不要
- GPU利用でより高速な音声生成が可能（オプション）

**推奨構成例**

1. `docker-compose` で `app` コンテナを定義（Kokoro TTS同梱）
2. cronで `docker-compose up` を起動
3. 完了後 `docker-compose down`

---

以上
